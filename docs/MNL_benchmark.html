---

title: MNL benchmark


keywords: fastai
sidebar: home_sidebar

summary: "Benchmark with Swissmetro dataset => Chang utility function same as in TasteNet paper"
description: "Benchmark with Swissmetro dataset => Chang utility function same as in TasteNet paper"
nb_path: "01_MNL_benchmark.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_MNL_benchmark.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Data-preparation">Data preparation<a class="anchor-link" href="#Data-preparation"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/swissmetro_train.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(7484, 28)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GROUP</th>
      <th>SURVEY</th>
      <th>SP</th>
      <th>ID</th>
      <th>PURPOSE</th>
      <th>FIRST</th>
      <th>TICKET</th>
      <th>WHO</th>
      <th>LUGGAGE</th>
      <th>AGE</th>
      <th>...</th>
      <th>TRAIN_TT</th>
      <th>TRAIN_CO</th>
      <th>TRAIN_HE</th>
      <th>SM_TT</th>
      <th>SM_CO</th>
      <th>SM_HE</th>
      <th>SM_SEATS</th>
      <th>CAR_TT</th>
      <th>CAR_CO</th>
      <th>CHOICE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>7484.0</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>...</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
      <td>7484.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2.631614</td>
      <td>0.631614</td>
      <td>1.0</td>
      <td>597.088856</td>
      <td>2.899653</td>
      <td>0.473544</td>
      <td>2.898049</td>
      <td>1.497595</td>
      <td>0.675975</td>
      <td>2.898985</td>
      <td>...</td>
      <td>167.127338</td>
      <td>512.706975</td>
      <td>69.857028</td>
      <td>87.760289</td>
      <td>669.774452</td>
      <td>20.061464</td>
      <td>0.117451</td>
      <td>124.153260</td>
      <td>79.018306</td>
      <td>2.155933</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.482399</td>
      <td>0.482399</td>
      <td>0.0</td>
      <td>343.772433</td>
      <td>1.110953</td>
      <td>0.499333</td>
      <td>2.191708</td>
      <td>0.710073</td>
      <td>0.599483</td>
      <td>1.027071</td>
      <td>...</td>
      <td>78.343306</td>
      <td>1083.101925</td>
      <td>37.295564</td>
      <td>55.210542</td>
      <td>1436.019973</td>
      <td>8.164189</td>
      <td>0.321978</td>
      <td>89.711416</td>
      <td>55.083844</td>
      <td>0.629260</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>1.0</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>31.000000</td>
      <td>8.000000</td>
      <td>30.000000</td>
      <td>8.000000</td>
      <td>10.000000</td>
      <td>10.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>1.0</td>
      <td>299.000000</td>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>2.000000</td>
      <td>...</td>
      <td>110.000000</td>
      <td>58.000000</td>
      <td>30.000000</td>
      <td>54.000000</td>
      <td>71.000000</td>
      <td>10.000000</td>
      <td>0.000000</td>
      <td>70.000000</td>
      <td>40.000000</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>1.0</td>
      <td>599.000000</td>
      <td>3.000000</td>
      <td>0.000000</td>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>3.000000</td>
      <td>...</td>
      <td>159.000000</td>
      <td>94.000000</td>
      <td>60.000000</td>
      <td>79.000000</td>
      <td>112.000000</td>
      <td>20.000000</td>
      <td>0.000000</td>
      <td>120.000000</td>
      <td>76.000000</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>1.0</td>
      <td>893.000000</td>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>3.000000</td>
      <td>2.000000</td>
      <td>1.000000</td>
      <td>4.000000</td>
      <td>...</td>
      <td>209.000000</td>
      <td>173.000000</td>
      <td>120.000000</td>
      <td>110.000000</td>
      <td>210.000000</td>
      <td>30.000000</td>
      <td>0.000000</td>
      <td>176.000000</td>
      <td>112.000000</td>
      <td>3.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>1.0</td>
      <td>1192.000000</td>
      <td>8.000000</td>
      <td>1.000000</td>
      <td>10.000000</td>
      <td>3.000000</td>
      <td>3.000000</td>
      <td>5.000000</td>
      <td>...</td>
      <td>1049.000000</td>
      <td>5040.000000</td>
      <td>120.000000</td>
      <td>796.000000</td>
      <td>6720.000000</td>
      <td>30.000000</td>
      <td>1.000000</td>
      <td>1560.000000</td>
      <td>520.000000</td>
      <td>3.000000</td>
    </tr>
  </tbody>
</table>
<p>8 rows Ã— 28 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index([&#39;GROUP&#39;, &#39;SURVEY&#39;, &#39;SP&#39;, &#39;ID&#39;, &#39;PURPOSE&#39;, &#39;FIRST&#39;, &#39;TICKET&#39;, &#39;WHO&#39;,
       &#39;LUGGAGE&#39;, &#39;AGE&#39;, &#39;MALE&#39;, &#39;INCOME&#39;, &#39;GA&#39;, &#39;ORIGIN&#39;, &#39;DEST&#39;, &#39;TRAIN_AV&#39;,
       &#39;CAR_AV&#39;, &#39;SM_AV&#39;, &#39;TRAIN_TT&#39;, &#39;TRAIN_CO&#39;, &#39;TRAIN_HE&#39;, &#39;SM_TT&#39;, &#39;SM_CO&#39;,
       &#39;SM_HE&#39;, &#39;SM_SEATS&#39;, &#39;CAR_TT&#39;, &#39;CAR_CO&#39;, &#39;CHOICE&#39;],
      dtype=&#39;object&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">AGE</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>3    2682
2    2321
4    1425
5     563
1     493
Name: AGE, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.-Biogeme">1. Biogeme<a class="anchor-link" href="#1.-Biogeme"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">database</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="s1">&#39;swissmetro&#39;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">database</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ASC_TRAIN</span> <span class="o">=</span> <span class="n">Beta</span><span class="p">(</span><span class="s1">&#39;ASC_TRAIN&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ASC_SM</span> <span class="o">=</span> <span class="n">Beta</span><span class="p">(</span><span class="s1">&#39;ASC_SM&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ASC_CAR</span> <span class="o">=</span> <span class="n">Beta</span><span class="p">(</span><span class="s1">&#39;ASC_CAR&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># Constant</span>

<span class="n">B_TIME_TRAIN</span> <span class="o">=</span> <span class="n">Beta</span><span class="p">(</span><span class="s1">&#39;B_TIME_TRAIN&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">B_TIME_SM</span> <span class="o">=</span> <span class="n">Beta</span><span class="p">(</span><span class="s1">&#39;B_TIME_SM&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">B_TIME_CAR</span> <span class="o">=</span> <span class="n">Beta</span><span class="p">(</span><span class="s1">&#39;B_TIME_CAR&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">B_HEADWAY_TRAIN</span> <span class="o">=</span> <span class="n">Beta</span><span class="p">(</span><span class="s1">&#39;B_HEADWAY_TRAIN&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">B_HEADWAY_SM</span> <span class="o">=</span> <span class="n">Beta</span><span class="p">(</span><span class="s1">&#39;B_HEADWAY_SM&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">B_COST_TRAIN</span> <span class="o">=</span> <span class="n">Beta</span><span class="p">(</span><span class="s1">&#39;B_COST_TRAIN&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># Fixed</span>
<span class="n">B_COST_SM</span> <span class="o">=</span> <span class="n">Beta</span><span class="p">(</span><span class="s1">&#39;B_COST_SM&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># Fixed</span>
<span class="n">B_COST_CAR</span> <span class="o">=</span> <span class="n">Beta</span><span class="p">(</span><span class="s1">&#39;B_COST_CAR&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># Fixed</span>
<span class="c1"># B_COST_TRAIN = Beta(&#39;B_COST_TRAIN&#39;, 0, None, None, 0) # Fixed</span>
<span class="c1"># B_COST_SM = Beta(&#39;B_COST_SM&#39;, 0, None, None, 0) # Fixed</span>
<span class="c1"># B_COST_CAR = Beta(&#39;B_COST_CAR&#39;, 0, None, None, 0) # Fixed</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SM_CO</span> <span class="o">=</span> <span class="n">SM_CO</span> <span class="o">*</span> <span class="p">(</span><span class="n">GA</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">TRAIN_CO</span> <span class="o">=</span> <span class="n">TRAIN_CO</span> <span class="o">*</span> <span class="p">(</span><span class="n">GA</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">CAR_AV</span> <span class="o">=</span> <span class="n">CAR_AV</span> <span class="o">*</span> <span class="p">(</span><span class="n">SP</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">TRAIN_AV</span> <span class="o">=</span> <span class="n">TRAIN_AV</span> <span class="o">*</span> <span class="p">(</span><span class="n">SP</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">V1</span> <span class="o">=</span> <span class="n">ASC_TRAIN</span> <span class="o">+</span> <span class="n">B_TIME_TRAIN</span> <span class="o">*</span> <span class="n">TRAIN_TT</span> <span class="o">+</span> <span class="n">B_HEADWAY_TRAIN</span> <span class="o">*</span> <span class="n">TRAIN_HE</span> <span class="o">+</span> <span class="n">B_COST_TRAIN</span> <span class="o">*</span> <span class="n">TRAIN_CO</span>
<span class="n">V2</span> <span class="o">=</span> <span class="n">ASC_SM</span> <span class="o">+</span> <span class="n">B_TIME_SM</span> <span class="o">*</span> <span class="n">SM_TT</span> <span class="o">+</span> <span class="n">B_HEADWAY_SM</span> <span class="o">*</span> <span class="n">SM_HE</span> <span class="o">+</span> <span class="n">B_COST_SM</span> <span class="o">*</span> <span class="n">SM_CO</span>
<span class="n">V3</span> <span class="o">=</span> <span class="n">ASC_CAR</span> <span class="o">+</span> <span class="n">B_TIME_CAR</span> <span class="o">*</span> <span class="n">CAR_TT</span> <span class="o">+</span> <span class="n">B_COST_CAR</span> <span class="o">*</span> <span class="n">CAR_CO</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">V</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">V1</span><span class="p">,</span>
     <span class="mi">2</span><span class="p">:</span> <span class="n">V2</span><span class="p">,</span>
     <span class="mi">3</span><span class="p">:</span> <span class="n">V3</span><span class="p">}</span>

<span class="c1"># Associate the availability conditions with the alternatives</span>
<span class="n">av</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="n">TRAIN_AV</span><span class="p">,</span>
      <span class="mi">2</span><span class="p">:</span> <span class="n">SM_AV</span><span class="p">,</span>
      <span class="mi">3</span><span class="p">:</span> <span class="n">CAR_AV</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># observation to the log likelihood function.</span>
<span class="n">logprob</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">loglogit</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">av</span><span class="p">,</span> <span class="n">CHOICE</span><span class="p">)</span>

<span class="c1"># Create the Biogeme object</span>
<span class="n">biogeme</span> <span class="o">=</span> <span class="n">bio</span><span class="o">.</span><span class="n">BIOGEME</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">logprob</span><span class="p">)</span>
<span class="c1"># biogeme.modelName = &#39;01logit&#39;</span>
<span class="n">biogeme</span><span class="o">.</span><span class="n">modelName</span> <span class="o">=</span> <span class="s1">&#39;MNL_A&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">biogeme</span><span class="o">.</span><span class="n">estimate</span><span class="p">()</span>
<span class="c1"># Get the results in a pandas table</span>
<span class="n">pandasResults</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">getEstimatedParameters</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pandasResults</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>                    Value   Std err     t-test       p-value  Rob. Std err  \
ASC_SM           0.729244  0.098901   7.373464  1.663114e-13      0.109824   
ASC_TRAIN        0.956208  0.129172   7.402585  1.334488e-13      0.135637   
B_COST_CAR      -0.006672  0.000943  -7.071452  1.533218e-12      0.001259   
B_COST_SM       -0.007911  0.000446 -17.734670  0.000000e+00      0.000627   
B_COST_TRAIN    -0.018745  0.000951 -19.703251  0.000000e+00      0.001515   
B_HEADWAY_SM    -0.007075  0.003051  -2.319051  2.039228e-02      0.003102   
B_HEADWAY_TRAIN -0.006277  0.001002  -6.265781  3.709619e-10      0.000994   
B_TIME_CAR      -0.009673  0.000690 -14.020815  0.000000e+00      0.001241   
B_TIME_SM       -0.013123  0.000730 -17.978813  0.000000e+00      0.001307   
B_TIME_TRAIN    -0.012936  0.000768 -16.836669  0.000000e+00      0.001071   

                 Rob. t-test  Rob. p-value  
ASC_SM              6.640130  3.134049e-11  
ASC_TRAIN           7.049757  1.792344e-12  
B_COST_CAR         -5.299768  1.159498e-07  
B_COST_SM         -12.621475  0.000000e+00  
B_COST_TRAIN      -12.370855  0.000000e+00  
B_HEADWAY_SM       -2.281099  2.254256e-02  
B_HEADWAY_TRAIN    -6.312293  2.749310e-10  
B_TIME_CAR         -7.792234  6.661338e-15  
B_TIME_SM         -10.038817  0.000000e+00  
B_TIME_TRAIN      -12.083294  0.000000e+00  
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pandasResults</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ASC_SM             0.729244
ASC_TRAIN          0.956208
B_COST_CAR        -0.006672
B_COST_SM         -0.007911
B_COST_TRAIN      -0.018745
B_HEADWAY_SM      -0.007075
B_HEADWAY_TRAIN   -0.006277
B_TIME_CAR        -0.009673
B_TIME_SM         -0.013123
B_TIME_TRAIN      -0.012936
Name: Value, dtype: float64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># of about the same size, randomly defined. Each slice is considered</span>
<span class="c1"># as a validation dataset. The model is then re-estimated using all</span>
<span class="c1"># the data except the slice, and the estimated model is applied on the</span>
<span class="c1"># validation set (i.e. the slice). The value of the log likelihood for</span>
<span class="c1"># each observation in the validation set is reported in a</span>
<span class="c1"># dataframe. As this is done for each slice, the output is a list of</span>
<span class="c1"># dataframes, each corresponding to one of these exercises.</span>

<span class="n">validation_results</span> <span class="o">=</span> <span class="n">biogeme</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">results</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>

<span class="k">for</span> <span class="n">slide</span> <span class="ow">in</span> <span class="n">validation_results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Log likelihood for </span><span class="si">{</span><span class="n">slide</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> validation data: </span><span class="si">{</span><span class="n">slide</span><span class="p">[</span><span class="s2">&quot;Loglikelihood&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Log likelihood for 1497 validation data: -22072.582684325316
Log likelihood for 1497 validation data: -19786.512933319646
Log likelihood for 1497 validation data: -22761.069770956114
Log likelihood for 1497 validation data: -22437.29734738394
Log likelihood for 1496 validation data: -18503.098702511194
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">slices</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">validationData</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">validationData</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>zip</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">validationData</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;tuple&#39;&gt;
&lt;class &#39;tuple&#39;&gt;
&lt;class &#39;tuple&#39;&gt;
&lt;class &#39;tuple&#39;&gt;
&lt;class &#39;tuple&#39;&gt;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(tuple, 2)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(pandas.core.frame.DataFrame,
 pandas.core.frame.DataFrame,
 (8554, 28),
 (2138, 28))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">keepDatabase</span> <span class="o">=</span> <span class="n">database</span>
<span class="nb">type</span><span class="p">(</span><span class="n">keepDatabase</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>biogeme.database.Database</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">estimationResults</span> <span class="o">=</span> <span class="n">results</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">allSimulationResults</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">validationData</span><span class="p">:</span>
    <span class="c1"># v[0] is the estimation data set</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="s1">&#39;Estimation data&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">biogeme</span><span class="o">.</span><span class="n">loglike</span><span class="o">.</span><span class="n">changeInitValues</span><span class="p">(</span><span class="n">estimationResults</span><span class="o">.</span><span class="n">getBetaValues</span><span class="p">())</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">biogeme</span><span class="o">.</span><span class="n">estimate</span><span class="p">()</span>
    <span class="n">simulate</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Loglikelihood&#39;</span><span class="p">:</span> <span class="n">biogeme</span><span class="o">.</span><span class="n">loglike</span><span class="p">}</span>
<span class="c1">#     simBiogeme = BIOGEME(db.Database(&#39;Validation data&#39;, v[1]),</span>
<span class="c1">#                          simulate)</span>
<span class="c1">#     simResult = simBiogeme.simulate(results.getBetaValues())</span>
    <span class="n">simResult</span> <span class="o">=</span> <span class="n">biogeme</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">getBetaValues</span><span class="p">())</span>
    <span class="n">allSimulationResults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simResult</span><span class="p">)</span>
<span class="n">biogeme</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">keepDatabase</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">allSimulationResults</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">slide</span><span class="p">),</span> <span class="n">slide</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(pandas.core.frame.DataFrame, (2138, 1))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">results</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;biogeme.results.bioResults at 0x7f612150fc10&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="PyLogit">PyLogit<a class="anchor-link" href="#PyLogit"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Load the raw swiss metro data</span>
<span class="c1"># Note the .dat files are tab delimited text files</span>
<span class="n">swissmetro_wide</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./data/swissmetro.dat&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># **AND** whose PURPOSE is either 1 or 3</span>
<span class="n">include_criteria</span> <span class="o">=</span> <span class="p">(</span><span class="n">swissmetro_wide</span><span class="o">.</span><span class="n">PURPOSE</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">swissmetro_wide</span><span class="o">.</span><span class="n">CHOICE</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Use &quot;.copy()&quot; so that later on, we avoid performing operations </span>
<span class="c1"># on a view of a dataframe as opposed to on an actual dataframe</span>
<span class="n">clean_sm_wide</span> <span class="o">=</span> <span class="n">swissmetro_wide</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">include_criteria</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Look at how many observations we have after removing unwanted</span>
<span class="c1"># observations</span>
<span class="n">final_num_obs</span> <span class="o">=</span> <span class="n">clean_sm_wide</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">num_obs_statement</span> <span class="o">=</span> <span class="s2">&quot;The cleaned number of observations is </span><span class="si">{:,.0f}</span><span class="s2">.&quot;</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">num_obs_statement</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">final_num_obs</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The cleaned number of observations is 6,768.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># panel/repeated-observations dataset, and start the &quot;custom_id&quot; from 1</span>
<span class="n">clean_sm_wide</span><span class="p">[</span><span class="s2">&quot;custom_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">clean_sm_wide</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># Create the list of individual specific variables</span>
<span class="n">ind_variables</span> <span class="o">=</span> <span class="n">clean_sm_wide</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[:</span><span class="mi">15</span><span class="p">]</span>

<span class="c1"># Specify the variables that vary across individuals **AND** </span>
<span class="c1"># across some or all alternatives</span>
<span class="n">alt_varying_variables</span> <span class="o">=</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;travel_time&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;TRAIN_TT&#39;</span><span class="p">),</span>
                                               <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;SM_TT&#39;</span><span class="p">),</span>
                                               <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;CAR_TT&#39;</span><span class="p">)]),</span>
                          <span class="sa">u</span><span class="s1">&#39;travel_cost&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;TRAIN_CO&#39;</span><span class="p">),</span>
                                                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;SM_CO&#39;</span><span class="p">),</span>
                                                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;CAR_CO&#39;</span><span class="p">)]),</span>
                          <span class="sa">u</span><span class="s1">&#39;headway&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;TRAIN_HE&#39;</span><span class="p">),</span>
                                            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;SM_HE&#39;</span><span class="p">)]),</span>
                          <span class="sa">u</span><span class="s1">&#39;seat_configuration&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">([(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;SM_SEATS&quot;</span><span class="p">)])}</span>

<span class="c1"># Specify the availability variables</span>
<span class="n">availability_variables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;TRAIN_AV&#39;</span><span class="p">,</span> <span class="s1">&#39;SM_AV&#39;</span><span class="p">,</span> <span class="s1">&#39;CAR_AV&#39;</span><span class="p">]))</span>

<span class="c1"># Determine the columns that will denote the</span>
<span class="c1"># new column of alternative ids, and the columns</span>
<span class="c1"># that denote the custom observation ids and the </span>
<span class="c1"># choice column</span>
<span class="n">new_alt_id</span> <span class="o">=</span> <span class="s2">&quot;mode_id&quot;</span>
<span class="n">obs_id_column</span> <span class="o">=</span> <span class="s2">&quot;custom_id&quot;</span>
<span class="n">choice_column</span> <span class="o">=</span> <span class="s2">&quot;CHOICE&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">long_swiss_metro</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">convert_wide_to_long</span><span class="p">(</span><span class="n">clean_sm_wide</span><span class="p">,</span> 
                                           <span class="n">ind_variables</span><span class="p">,</span> 
                                           <span class="n">alt_varying_variables</span><span class="p">,</span> 
                                           <span class="n">availability_variables</span><span class="p">,</span> 
                                           <span class="n">obs_id_column</span><span class="p">,</span> 
                                           <span class="n">choice_column</span><span class="p">,</span>
                                           <span class="n">new_alt_id_name</span><span class="o">=</span><span class="n">new_alt_id</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">long_swiss_metro</span><span class="p">[</span><span class="s2">&quot;travel_time_hundredth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">long_swiss_metro</span><span class="p">[</span><span class="s2">&quot;travel_time&quot;</span><span class="p">]</span> <span class="o">/</span>
                                             <span class="mf">100.0</span><span class="p">)</span>

<span class="c1"># Figure out which rows correspond to train or swiss metro </span>
<span class="c1"># alternatives for individuals with GA passes. These individuals face no </span>
<span class="c1"># marginal costs for a trip</span>
<span class="n">train_pass_train_alt</span> <span class="o">=</span> <span class="p">((</span><span class="n">long_swiss_metro</span><span class="p">[</span><span class="s2">&quot;GA&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span>
                        <span class="p">(</span><span class="n">long_swiss_metro</span><span class="p">[</span><span class="s2">&quot;mode_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="c1"># Note that the (train_pass_train_alt == 0) term accounts for the</span>
<span class="c1"># fact that those with a GA pass have no marginal cost for the trip</span>
<span class="n">long_swiss_metro</span><span class="p">[</span><span class="s2">&quot;travel_cost_hundredth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">long_swiss_metro</span><span class="p">[</span><span class="s2">&quot;travel_cost&quot;</span><span class="p">]</span> <span class="o">*</span>
                                             <span class="p">(</span><span class="n">train_pass_train_alt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span>
                                             <span class="mf">100.0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/danph/anaconda3/envs/ml-dchoice/lib/python3.7/site-packages/pandas/core/computation/expressions.py:204: UserWarning: evaluating in Python space because the &#39;*&#39; operator is not supported by numexpr for the bool dtype, use &#39;&amp;&#39; instead
  f&#34;evaluating in Python space because the {repr(op_str)} &#34;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># an instance of the MNL model class</span>
<span class="n">example_mnl</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">create_choice_model</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">long_swiss_metro</span><span class="p">,</span>
                                     <span class="n">alt_id_col</span><span class="o">=</span><span class="n">new_alt_id</span><span class="p">,</span>
                                     <span class="n">obs_id_col</span><span class="o">=</span><span class="n">obs_id_column</span><span class="p">,</span>
                                     <span class="n">choice_col</span><span class="o">=</span><span class="n">choice_column</span><span class="p">,</span>
                                     <span class="n">specification</span><span class="o">=</span><span class="n">example_specification</span><span class="p">,</span>
                                     <span class="n">model_type</span><span class="o">=</span><span class="s2">&quot;MNL&quot;</span><span class="p">,</span>
                                     <span class="n">names</span><span class="o">=</span><span class="n">example_names</span><span class="p">)</span>

<span class="c1"># Start the model estimation from initial values of all zeros</span>
<span class="c1"># i.e. 4 zeros for the 4 coefficients being estimated</span>
<span class="n">example_mnl</span><span class="o">.</span><span class="n">fit_mle</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Log-likelihood at zero: -6,964.6630
Initial Log-likelihood: -6,964.6630
Estimation Time for Point Estimation: 0.03 seconds.
Final log-likelihood: -5,331.2520
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/danph/anaconda3/envs/ml-dchoice/lib/python3.7/site-packages/scipy/optimize/_minimize.py:523: RuntimeWarning: Method BFGS does not use Hessian information (hess).
  RuntimeWarning)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_mnl</span><span class="o">.</span><span class="n">get_statsmodels_summary</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<table class="simpletable">
<caption>Multinomial Logit Model Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>         <td>CHOICE</td>          <th>  No. Observations:  </th>    <td>6,768</td>  
</tr>
<tr>
  <th>Model:</th>         <td>Multinomial Logit Model</td> <th>  Df Residuals:      </th>    <td>6,764</td>  
</tr>
<tr>
  <th>Method:</th>                  <td>MLE</td>           <th>  Df Model:          </th>      <td>4</td>    
</tr>
<tr>
  <th>Date:</th>             <td>Wed, 10 Mar 2021</td>     <th>  Pseudo R-squ.:     </th>    <td>0.235</td>  
</tr>
<tr>
  <th>Time:</th>                 <td>19:34:53</td>         <th>  Pseudo R-bar-squ.: </th>    <td>0.234</td>  
</tr>
<tr>
  <th>AIC:</th>                 <td>10,670.504</td>        <th>  Log-Likelihood:    </th> <td>-5,331.252</td>
</tr>
<tr>
  <th>BIC:</th>                 <td>10,697.784</td>        <th>  LL-Null:           </th> <td>-6,964.663</td>
</tr>
</table>
<table class="simpletable">
<tr>
      <td></td>         <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>ASC Car</th>   <td>   -0.1546</td> <td>    0.043</td> <td>   -3.577</td> <td> 0.000</td> <td>   -0.239</td> <td>   -0.070</td>
</tr>
<tr>
  <th>ASC Train</th> <td>   -0.7012</td> <td>    0.055</td> <td>  -12.778</td> <td> 0.000</td> <td>   -0.809</td> <td>   -0.594</td>
</tr>
<tr>
  <th>B_COST</th>    <td>   -1.0838</td> <td>    0.052</td> <td>  -20.910</td> <td> 0.000</td> <td>   -1.185</td> <td>   -0.982</td>
</tr>
<tr>
  <th>B_TIME</th>    <td>   -1.2779</td> <td>    0.057</td> <td>  -22.465</td> <td> 0.000</td> <td>   -1.389</td> <td>   -1.166</td>
</tr>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

