---

title: Exploring Tastenet MNL

keywords: fastai
sidebar: home_sidebar

summary: "Exploring Tastenet MNL."
description: "Exploring Tastenet MNL."
nb_path: "10_tastenet_mnl.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 10_tastenet_mnl.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="models">models<a class="anchor-link" href="#models"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_act" class="doc_header"><code>get_act</code><a href="__main__.py#L8" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_act</code>(<strong><code>nl_func</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ChoiceFlex" class="doc_header"><code>class</code> <code>ChoiceFlex</code><a href="" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ChoiceFlex</code>(<strong><code>args</code></strong>) :: <code>Module</code></p>
</blockquote>
<p>Base class for all neural network modules.</p>
<p>Your models should also subclass this class.</p>
<p>Modules can also contain other Modules, allowing to nest them in
a tree structure. You can assign the submodules as regular attributes::</p>

<pre><code>import torch.nn as nn
import torch.nn.functional as F

class Model(nn.Module):
    def __init__(self):
        super(Model, self).__init__()
        self.conv1 = nn.Conv2d(1, 20, 5)
        self.conv2 = nn.Conv2d(20, 20, 5)

    def forward(self, x):
        x = F.relu(self.conv1(x))
        return F.relu(self.conv2(x))

</code></pre>
<p>Submodules assigned in this way will be registered, and will have their
parameters converted too when you call :meth:<code>to</code>, etc.</p>
<p>:ivar training: Boolean represents whether this module is in training or
                evaluation mode.
:vartype training: bool</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Utility" class="doc_header"><code>class</code> <code>Utility</code><a href="" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Utility</code>(<strong><code>args</code></strong>) :: <code>Module</code></p>
</blockquote>
<p>Base class for all neural network modules.</p>
<p>Your models should also subclass this class.</p>
<p>Modules can also contain other Modules, allowing to nest them in
a tree structure. You can assign the submodules as regular attributes::</p>

<pre><code>import torch.nn as nn
import torch.nn.functional as F

class Model(nn.Module):
    def __init__(self):
        super(Model, self).__init__()
        self.conv1 = nn.Conv2d(1, 20, 5)
        self.conv2 = nn.Conv2d(20, 20, 5)

    def forward(self, x):
        x = F.relu(self.conv1(x))
        return F.relu(self.conv2(x))

</code></pre>
<p>Submodules assigned in this way will be registered, and will have their
parameters converted too when you call :meth:<code>to</code>, etc.</p>
<p>:ivar training: Boolean represents whether this module is in training or
                evaluation mode.
:vartype training: bool</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TasteParams" class="doc_header"><code>class</code> <code>TasteParams</code><a href="" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TasteParams</code>(<strong><code>layer_sizes</code></strong>, <strong><code>args</code></strong>) :: <code>Module</code></p>
</blockquote>
<p>Network for tastes
Structure: MLP</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="data_utils">data_utils<a class="anchor-link" href="#data_utils"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ChoiceDataset" class="doc_header"><code>class</code> <code>ChoiceDataset</code><a href="" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ChoiceDataset</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwds</code></strong>) :: <code>Dataset</code></p>
</blockquote>
<p>Choice dataset</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="getAttribute" class="doc_header"><code>getAttribute</code><a href="__main__.py#L66" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>getAttribute</code>(<strong><code>x</code></strong>, <strong><code>x_names</code></strong>, <strong><code>name</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="selectZ" class="doc_header"><code>selectZ</code><a href="__main__.py#L69" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>selectZ</code>(<strong><code>z</code></strong>, <strong><code>z_selected</code></strong>, <strong><code>z_names</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>   
<span class="c1"># data_path = &#39;./data&#39;</span>
<span class="c1"># data_file = &#39;swissmetro_all.pkl&#39;</span>
<span class="c1"># ds = ChoiceDataset(data_path, data_file)</span>
<span class="c1"># print(ds.x.size())</span>
<span class="c1"># print(ds.z.size())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Data-preparation">Data preparation<a class="anchor-link" href="#Data-preparation"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/swissmetro.dat&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;	&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(10728, 28)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;AGE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;AGE&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">]</span>
<span class="c1"># Remove &quot;other&quot; trip purpose (9)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;PURPOSE&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">9</span><span class="p">]</span>
<span class="c1"># Remove &quot;unknown&quot; choice (0)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;CHOICE&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(10692, 28)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;./data/swissmetro_all.pkl&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./data/swissmetro_all.pkl&#39;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GROUP</th>
      <th>SURVEY</th>
      <th>SP</th>
      <th>ID</th>
      <th>PURPOSE</th>
      <th>FIRST</th>
      <th>TICKET</th>
      <th>WHO</th>
      <th>LUGGAGE</th>
      <th>AGE</th>
      <th>...</th>
      <th>TRAIN_TT</th>
      <th>TRAIN_CO</th>
      <th>TRAIN_HE</th>
      <th>SM_TT</th>
      <th>SM_CO</th>
      <th>SM_HE</th>
      <th>SM_SEATS</th>
      <th>CAR_TT</th>
      <th>CAR_CO</th>
      <th>CHOICE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>...</td>
      <td>112</td>
      <td>48</td>
      <td>120</td>
      <td>63</td>
      <td>52</td>
      <td>20</td>
      <td>0</td>
      <td>117</td>
      <td>65</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>...</td>
      <td>103</td>
      <td>48</td>
      <td>30</td>
      <td>60</td>
      <td>49</td>
      <td>10</td>
      <td>0</td>
      <td>117</td>
      <td>84</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>...</td>
      <td>130</td>
      <td>48</td>
      <td>60</td>
      <td>67</td>
      <td>58</td>
      <td>30</td>
      <td>0</td>
      <td>117</td>
      <td>52</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>...</td>
      <td>103</td>
      <td>40</td>
      <td>30</td>
      <td>63</td>
      <td>52</td>
      <td>20</td>
      <td>0</td>
      <td>72</td>
      <td>52</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>...</td>
      <td>130</td>
      <td>36</td>
      <td>60</td>
      <td>63</td>
      <td>42</td>
      <td>20</td>
      <td>0</td>
      <td>90</td>
      <td>84</td>
      <td>2</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>10723</th>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1192</td>
      <td>4</td>
      <td>1</td>
      <td>7</td>
      <td>1</td>
      <td>0</td>
      <td>5</td>
      <td>...</td>
      <td>148</td>
      <td>13</td>
      <td>30</td>
      <td>93</td>
      <td>17</td>
      <td>30</td>
      <td>0</td>
      <td>156</td>
      <td>56</td>
      <td>2</td>
    </tr>
    <tr>
      <th>10724</th>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1192</td>
      <td>4</td>
      <td>1</td>
      <td>7</td>
      <td>1</td>
      <td>0</td>
      <td>5</td>
      <td>...</td>
      <td>148</td>
      <td>12</td>
      <td>30</td>
      <td>96</td>
      <td>16</td>
      <td>10</td>
      <td>0</td>
      <td>96</td>
      <td>70</td>
      <td>3</td>
    </tr>
    <tr>
      <th>10725</th>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1192</td>
      <td>4</td>
      <td>1</td>
      <td>7</td>
      <td>1</td>
      <td>0</td>
      <td>5</td>
      <td>...</td>
      <td>148</td>
      <td>16</td>
      <td>60</td>
      <td>93</td>
      <td>16</td>
      <td>20</td>
      <td>0</td>
      <td>96</td>
      <td>56</td>
      <td>3</td>
    </tr>
    <tr>
      <th>10726</th>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1192</td>
      <td>4</td>
      <td>1</td>
      <td>7</td>
      <td>1</td>
      <td>0</td>
      <td>5</td>
      <td>...</td>
      <td>178</td>
      <td>16</td>
      <td>30</td>
      <td>96</td>
      <td>17</td>
      <td>30</td>
      <td>0</td>
      <td>96</td>
      <td>91</td>
      <td>2</td>
    </tr>
    <tr>
      <th>10727</th>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1192</td>
      <td>4</td>
      <td>1</td>
      <td>7</td>
      <td>1</td>
      <td>0</td>
      <td>5</td>
      <td>...</td>
      <td>148</td>
      <td>13</td>
      <td>60</td>
      <td>96</td>
      <td>21</td>
      <td>30</td>
      <td>0</td>
      <td>120</td>
      <td>70</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
<p>10692 rows Ã— 28 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dic_attr</span> <span class="o">=</span> \
<span class="p">{</span><span class="s2">&quot;TRAIN&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;TRAIN_TT&quot;</span><span class="p">,</span> <span class="s2">&quot;TRAIN_HE&quot;</span><span class="p">,</span> <span class="s2">&quot;TRAIN_CO&quot;</span><span class="p">],</span> \
 <span class="s2">&quot;SM&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SM_TT&quot;</span><span class="p">,</span> <span class="s2">&quot;SM_HE&quot;</span><span class="p">,</span> <span class="s2">&quot;SM_CO&quot;</span><span class="p">,</span> <span class="s2">&quot;SM_SEATS&quot;</span><span class="p">],</span>\
 <span class="s2">&quot;CAR&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;CAR_TT&quot;</span><span class="p">,</span> <span class="s2">&quot;CAR_CO&quot;</span><span class="p">]}</span>

<span class="n">x_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">dic_attr</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
    <span class="n">x_dict</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">dic_attr</span><span class="p">[</span><span class="n">mode</span><span class="p">]:</span>
        <span class="n">x_dict</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">attr</span><span class="p">:</span><span class="n">attr</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>TRAIN
SM
CAR
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x_dict</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;TRAIN&#39;: {&#39;TRAIN_TT&#39;: &#39;TRAIN_TT&#39;,
  &#39;TRAIN_HE&#39;: &#39;TRAIN_HE&#39;,
  &#39;TRAIN_CO&#39;: &#39;TRAIN_CO&#39;},
 &#39;SM&#39;: {&#39;SM_TT&#39;: &#39;SM_TT&#39;,
  &#39;SM_HE&#39;: &#39;SM_HE&#39;,
  &#39;SM_CO&#39;: &#39;SM_CO&#39;,
  &#39;SM_SEATS&#39;: &#39;SM_SEATS&#39;},
 &#39;CAR&#39;: {&#39;CAR_TT&#39;: &#39;CAR_TT&#39;, &#39;CAR_CO&#39;: &#39;CAR_CO&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">getAttribute</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_names</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">[:,</span><span class="n">x_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="k">def</span> <span class="nf">sampleZ</span><span class="p">(</span><span class="n">z_levels</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Randomly generate N samples for input z</span>
<span class="sd">    Returns </span>
<span class="sd">        z: (N,7) where 7 is the number of z(categorical)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">num_z</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_levels</span><span class="p">)</span> <span class="c1"># z dimension</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">num_z</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">z_levels</span><span class="p">:</span>
        <span class="n">z</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">z_levels</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,))</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">z</span>

<span class="k">def</span> <span class="nf">cat2dummies</span><span class="p">(</span><span class="n">df_z</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">num_levels</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convert z to dummies </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dmy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df_z</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
    <span class="n">dmy</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_levels</span><span class="p">)]</span>
    <span class="n">df_z</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_z</span><span class="p">,</span> <span class="n">dmy</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df_z</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="k">def</span> <span class="nf">generateZInput</span><span class="p">(</span><span class="n">N_samples</span><span class="p">,</span> <span class="n">z_levels</span><span class="p">):</span>
    <span class="n">D</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_levels</span><span class="p">)</span>
    <span class="n">z_samples</span> <span class="o">=</span> <span class="n">sampleZ</span><span class="p">(</span><span class="n">z_levels</span><span class="p">,</span> <span class="n">N_samples</span><span class="p">)</span>
    <span class="n">df_z</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">z_samples</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">z_levels</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">z_levels</span><span class="p">:</span>
        <span class="n">df_z</span> <span class="o">=</span> <span class="n">cat2dummies</span><span class="p">(</span><span class="n">df_z</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">z_levels</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df_z</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
    <span class="n">z_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">df_z</span><span class="p">[</span><span class="n">df_z</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">D</span><span class="p">:]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">z_input</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">z_levels</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100000</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">zt</span> <span class="o">=</span> <span class="n">sampleZ</span><span class="p">(</span><span class="n">z_levels</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="nb">type</span><span class="p">(</span><span class="n">zt</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Tensor</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">zt</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[9., 3.],
       [5., 4.],
       [2., 1.],
       ...,
       [3., 0.],
       [0., 1.],
       [1., 4.]], dtype=float32)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">zt</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="n">df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-13-56d2bee75e9d&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">import</span> pandas <span class="ansi-green-fg">as</span> pd
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>df <span class="ansi-blue-fg">=</span> pd<span class="ansi-blue-fg">.</span>DataFrame<span class="ansi-blue-fg">(</span>zt<span class="ansi-blue-fg">.</span>numpy<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> df<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>value_counts<span class="ansi-blue-fg">(</span>sort<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span>kind<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;bar&#39;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;zt&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">zt</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([100000, 2])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">generateZInput</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">z_levels</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>     A    B  A_0  A_1  A_2  A_3  A_4  A_5  A_6  A_7  A_8  A_9  B_0  B_1  B_2  \
0  0.0  3.0    1    0    0    0    0    0    0    0    0    0    0    0    0   
1  5.0  2.0    0    0    0    0    0    1    0    0    0    0    0    0    1   
2  4.0  2.0    0    0    0    0    1    0    0    0    0    0    0    0    1   
3  0.0  0.0    1    0    0    0    0    0    0    0    0    0    1    0    0   
4  7.0  4.0    0    0    0    0    0    0    0    1    0    0    0    0    0   

   B_3  B_4  
0    1    0  
1    0    0  
2    0    0  
3    0    0  
4    0    1  
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> <span class="n">ts</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(torch.Tensor, torch.Size([100000, 15]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ts</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0.],
        [0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 1., 0., 0.],
        [0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0.],
        [1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 1.]])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">layer_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">in_size</span><span class="p">,</span> <span class="n">out_size</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">layer_sizes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">layer_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">:])):</span> 
    <span class="c1">#layer_sizes = [input_size,..., K(number of parameters)]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">in_size</span><span class="p">,</span> <span class="n">out_size</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>5 3
3 6
6 7
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">layer_sizes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[5, 3, 6]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="n">layer_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[3, 6, 7]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([1., 1., 1.,  ..., 1., 1., 1.])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

